<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>Tastypie Tutorial: Advanced Data Preparation</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	<link type="text/css" rel="stylesheet" href="styles/site.paper.css">

</head>

<body>

<div class="navbar navbar-default navbar-fixed-top ">
<div class="container">
	<div class="navbar-header">
		<a class="navbar-brand" href="index.html">Tastypie</a>
		<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#topNavigation">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
        </button>
	</div>
	<div class="navbar-collapse collapse" id="topNavigation">
		<ul class="nav navbar-nav">
			
			<li class="dropdown">
				<a href="modules.list.html" class="dropdown-toggle" data-toggle="dropdown">Modules<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="module-tastypie.html">tastypie</a></li><li><a href="module-tastypie_fields.html">tastypie/fields</a></li><li><a href="module-tastypie_fields_api.html">tastypie/fields/api</a></li><li><a href="module-tastypie_fields_array.html">tastypie/fields/array</a></li><li><a href="module-tastypie_fields_boolean.html">tastypie/fields/boolean</a></li><li><a href="module-tastypie_fields_char.html">tastypie/fields/char</a></li><li><a href="module-tastypie_fields_date.html">tastypie/fields/date</a></li><li><a href="module-tastypie_fields_datetime.html">tastypie/fields/datetime</a></li><li><a href="module-tastypie_fields_file.html">tastypie/fields/file</a></li><li><a href="module-tastypie_fields_filepath.html">tastypie/fields/filepath</a></li><li><a href="module-tastypie_fields_float.html">tastypie/fields/float</a></li><li><a href="module-tastypie_fields_integer.html">tastypie/fields/integer</a></li><li><a href="module-tastypie_fields_object.html">tastypie/fields/object</a></li><li><a href="module-tastypie_fields_related.html">tastypie/fields/related</a></li><li><a href="module-tastypie_lib.html">tastypie/lib</a></li><li><a href="module-tastypie_lib_api.html">tastypie/lib/api</a></li><li><a href="module-tastypie_lib_cache.html">tastypie/lib/cache</a></li><li><a href="module-tastypie_lib_class.html">tastypie/lib/class</a></li><li><a href="module-tastypie_lib_class_options.html">tastypie/lib/class/options</a></li><li><a href="module-tastypie_lib_constants.html">tastypie/lib/constants</a></li><li><a href="module-tastypie_lib_exceptions.html">tastypie/lib/exceptions</a></li><li><a href="module-tastypie_lib_http.html">tastypie/lib/http</a></li><li><a href="module-tastypie_lib_mime.html">tastypie/lib/mime</a></li><li><a href="module-tastypie_lib_paginator.html">tastypie/lib/paginator</a></li><li><a href="module-tastypie_lib_resource.html">tastypie/lib/resource</a></li><li><a href="module-tastypie_lib_resource_detail.html">tastypie/lib/resource/detail</a></li><li><a href="module-tastypie_lib_resource_list.html">tastypie/lib/resource/list</a></li><li><a href="module-tastypie_lib_resource_schema.html">tastypie/lib/resource/schema</a></li><li><a href="module-tastypie_lib_resource_validator.html">tastypie/lib/resource/validator</a></li><li><a href="module-tastypie_lib_resource_validator_querystring.html">tastypie/lib/resource/validator/querystring</a></li><li><a href="module-tastypie_lib_serializer.html">tastypie/lib/serializer</a></li><li><a href="module-tastypie_lib_throttle.html">tastypie/lib/throttle</a></li><li><a href="module-tastypie_lib_util.html">tastypie/lib/util</a></li><li><a href="module-tastypie_lib_validators.html">tastypie/lib/validators</a></li><li><a href="parent.module_js.html">parent.js</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="module-lib_execpetions.BaseException.html">lib/execpetions.BaseException</a></li><li><a href="module-tastypie_lib_exceptions.ImproperlyConfigured.html">tastypie/lib/exceptions.ImproperlyConfigured</a></li><li><a href="module-tastypie_lib_exceptions.NotImplemented.html">tastypie/lib/exceptions.NotImplemented</a></li><li><a href="module-tastypie_lib_exceptions.ResourceFilterError.html">tastypie/lib/exceptions.ResourceFilterError</a></li><li><a href="module-tastypie_lib_exceptions.SerializationError.html">tastypie/lib/exceptions.SerializationError</a></li><li><a href="module-tastypie_lib_exceptions.UnsupportedFormat.html">tastypie/lib/exceptions.UnsupportedFormat</a></li><li><a href="module-tastypie_lib_paginator.Remote.html">tastypie/lib/paginator.Remote</a></li><li><a href="module-tastypie_lib_throttle.Memory.html">tastypie/lib/throttle.Memory</a></li><li><a href="module-tastypie_lib_validators.FormValidator.html">tastypie/lib/validators.FormValidator</a></li><li><a href="module-tastypie_lib_validators.JoiValidator.html">tastypie/lib/validators.JoiValidator</a></li><li><a href="module-tastypie_lib_validators.Validator.html">tastypie/lib/validators.Validator</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="tutorials.list.html" class="dropdown-toggle" data-toggle="dropdown">Tutorials<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="tutorial-getting-started.html">Getting Started</a></li><li><a href="tutorial-resources.html">Working With Resources</a></li><li><a href="tutorial-serializers.html">Working With Serializers</a></li><li><a href="tutorial-wfields.html">Working With Fields</a></li>
				</ul>
			</li>
			
		</ul>
        
            <div class="col-sm-3 col-md-3">
                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search" name="q" id="search-input">
                        <div class="input-group-btn">
                            <button class="btn btn-default" id="search-submit"><i class="glyphicon glyphicon-search"></i></button>
                        </div>
                    </div>
                </form>
            </div>
        
	</div>

</div>
</div>


<div class="container" id="toc-content">
<div class="row">

	
	<div class="col-md-12">
	
		<div id="main">
			<section class="tutorial-section">

<header>
    

    <h2>Advanced Data Preparation</h2>
</header>

<article>
    <p>One of the major components of a tastypie resource is the data preparation cycle, or <code>hydration</code> cycle. The hydration cycle is the aspect of a resource that is responsible for massaging raw user input into data objects suitable for saving to a data source, and vice versa.<br>The hydration cycle also encompasses the serialization machinery of the resource which is responsible for converting data object into standard data formats ( JSON, xml, etc ) and vice version</p>
<h2>Serializtion Cycle</h2><p>Each Tastypie resource has <a href="module-tastypie_lib_serializer.html">Serializer</a> instance which it uses internally to convert data between well formatted string and javascript objects. This behavior is defined in the <a href="module-tastypie_lib_resource.html#serialize">serialize</a> and <a href="module-tastypie_lib_resource.html#deserialize">deserialize</a> resource methods A serializer class defines how<br>data is converted to and from a string. This is done via the <code>to_</code> and <code>from_</code> methods for each of the formats. For example, the default serializer defines the following methods:</p>
<ul>
<li><a href="module-tastypie_lib_serializer.html#to_json">to_json</a> - Converts an object to a JSON string</li>
<li><a href="module-tastypie_lib_serializer.html#from_json">from_json</a> - Converts a JSON string to a javascript object</li>
<li><a href="module-tastypie_lib_serializer.html#to_xml">to_xml</a> - Converts a javascript object to an XML string</li>
<li><a href="module-tastypie_lib_serializer.html#from_xml">from_xml</a> - Converts an XML String to a javascript object</li>
</ul>
<h3>Serialization</h3><p>Serialization is the act of converting a javascript object into a standard format string - JSON string, XML String, YAML String, etc. In the simplest case this is as simple as calling <code>JSON.stringify</code>. To add support for serialization of a new format, you must define the <code>to_</code> method on a serializer class.</p>
<pre class="prettyprint source"><code>var tastypie = require('tastypie')
  , Class    = tastypie.Class
  , Serializer = tastypie.Serializer
  , JSONSerializer
  ;

JSONSerializer = new Class({

    inherits: Serializer

    ,options:{
        content_types :{
            'application/json':'json'
        }
    }

    ,to_json: function( data, options, callback ){
        callback( null, JSON.stringify( data ) );
    }

});</code></pre><h3>Deserialization</h3><p>Deserialization is the act of converting a standard format string ( usually from user input ) into a javascript object. To add support for deserialization of a new format, you must define the <code>from_</code> method on a serializer class.</p>
<pre class="prettyprint source"><code>var tastypie = require('tastypie')
  , Class    = tastypie.Class
  , Serializer = tastypie.Serializer
  , JSONSerializer
  ;

JSONSerializer = new Class({

    inherits: Serializer

    ,options:{
        content_types :{
            'application/json':'json'
        }
    }

    ,from_json: function( data, callback ){
        callback( null, JSON.parse( data ) );
    }

});</code></pre><h2>Hydration Cycle</h2><p>The hydration cycle is the component of a resource that enforces the data contract defined by the resource and it's fields  <a href="module-tastypie_fields.html">fields</a>. More specifically, <code>hydration</code> is the act of converting raw user input into a consistent data structure that is suitable to be handed off to application code. <code>Deyhdration</code> is the act of taking data returned from the application code and data layers and converting into a data structure suitable for serialization. </p>
<h3>Hydration</h3><p><a href="module-tastypie_lib_resource.html#full_hydrate">Hydration</a> Takes user input from a client request and re-shapes / re-maps it into a an object suitable for further processing. Commonly, this may be an ORM model for saving data to a data store or for using in additional application code. The <strong>key</strong> aspect of the hydration cycle centers around the <a href="module-tastypie_fields.html">fields</a> defined on the resource.</p>
<p>The attribute property on each of the field defines how the resource will reshape the incoming user input. The <code>attribute</code> can be a dot ( <code>.</code> ) separated name path to relocate each of the values from the input. If no <code>attribute</code> is defined, the name of field is used.</p>
<p><em>It is important to note that a resource will ignore any data found in the request payload. It is only concerned with matching field names.</em></p>
<pre class="prettyprint source"><code>var tastypie = require('tastypie')
  , Resource = tastypie.Resource
  , MyResource
  ;


MyResource = Resource.extend({
    options:{
        // resource specific defaults
    }    

    ,fields:{
        shallow : { type:'int' }
      , nested  : { type:'char', attribute:'a.b.c' }
    }
})</code></pre><p>The resource above defines two fields, one with an attribute and one with out - given a request payload as such:</p>
<pre class="prettyprint source"><code>{
    &quot;shallow&quot;: 10,
    &quot;nested&quot;:&quot;hello world&quot;,
    &quot;fake&quot;: true
}</code></pre><p>The result of hydration will result in an object with the following structure:</p>
<pre class="prettyprint source"><code>{
    &quot;shallow&quot;: 10,
    &quot;a&quot;:{
        &quot;b&quot;:{
            &quot;c&quot;:&quot;hello world&quot;    
        }
    }
}</code></pre><p>By defining an <code>attribute</code> on the <strong>nested</strong> field of <code>a.b.c</code>, the resource created an object structure to match the name path and set the value from the user input at the final property <code>c</code>, and ignored the non matching field value of <code>fake</code>.</p>
<h4>Per Field Hydration</h4><p>Situations arise when a simple field attribute may not be enough to express the mapping of a data structure between user input and the internal data structure you want to work with. For this, the hydration process exposes method hooks for each field. By defining a resource method prefixed with <code>hydrate</code> and the name of the field, you have to ability to return any value you wish as the data is being reshaped. The method is passed the entire request <a href="module-tastypie_lib_resource.html#~Bundle">Bundle</a> giving you the ability to directly change the internal data structure</p>
<pre class="prettyprint source"><code>var tastypie = require('tastypie')
  , Resource = tastypie.Resource
  , MyResource
  ;


MyResource = Resource.extend({
    options:{
        // resource specific defaults
    }    

    ,fields:{
        shallow : { type:'int' }
      , nested  : { type:'char', attribute:'a.b.c' }
      , fake    : { type:'bool' }
    }

    ,hydrate_fake: function( bundle ){
        if( bundle.data.shallow > 10 ){
            bundle.data.fake = true;
        } else {
            bundle.data.fake = false
        }

        return bundle;
    }
})</code></pre><p>Here the value of the <code>fake</code> field is dependent on the value of a different field. This soft of logic simply isn't possible with a name path style attribute, but is the same every time and a field hydration function is a good fit. At the time of writing, the per field hydration and dehydration functions are synchronous and must return a <a href="module-tastypie_lib_resource.html#~Bundle">Bundle</a> object.</p>
<h3>Dehydration</h3><p><a href="module-tastypie_lib_resource.html#full_dehydrate">Dehydration</a> is the inverse of <code>hydration</code>, taking a javascript object representing some internal data and reshaping it for serialization for delivery to the client by casting un-serializable object, removing circular references and some general type casting.   </p>
<p>Using the same resource as above:</p>
<pre class="prettyprint source"><code>MyResource = Resource.extend({
    options:{
        // resource specific defaults
    }    

    ,fields:{
        shallow : { type:'int' }
      , nested  : { type:'char', attribute:'a.b.c' }
    }
})</code></pre><p>We could pass a nested object through the <a href="module-tastypie_lib_resource.html#full_dehydrate">dehydrate</a> methods:</p>
<pre class="prettyprint source"><code>{
    &quot;shallow&quot;: 10,
    &quot;a&quot;:{
        &quot;b&quot;:{
            &quot;c&quot;:&quot;goodbye world&quot;    
        }
    }
}</code></pre><p>which would yield an object ready for serialization which looks like such:</p>
<pre class="prettyprint source"><code>{
    &quot;shallow&quot;: 10,
    &quot;nested&quot;:&quot;goodbye world&quot;
}</code></pre><h4>Per Field Dehydration</h4><p>As with the hydration process, you are able to define a dehydrate method for each field to control values returned for specific fields during the dehydration process prior to data being returned to the client. The method should have a <code>dehydrate_</code> prefix followed by the name of the field you want to manage. Unlike the hydration methods, the dehydration methods are passed the individual object being dehydrated, the <a href="module-tastypie_lib_resource.html#~Bundle">Bundle</a> object for the current request, and the the final dehydrated object that is being populated. These methods must return an individual value that is intended to populate the final field value</p>
<pre class="prettyprint source"><code>var tastypie = require('tastypie')
  , Resource = tastypie.Resource
  , MyResource
  ;


MyResource = Resource.extend({
    options:{
        // resource specific defaults
    }    

    ,fields:{
        shallow : { type:'int' }
      , nested  : { type:'char', attribute:'a.b.c' }
      , fake    : { type:'bool' }
    }

    ,dehydrate_shallow: function( item, bundle, dehydrated ){
        var value = 0;

        if( item.fake ){
            value = item.shallow + 10
        } else {
            value = item.shallow - 10
        }

        return value;
    }
})</code></pre>
</article>

</section>

		</div>
	</div>

	<div class="clearfix"></div>

	

</div>
</div>


    <div class="modal fade" id="searchResults">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Search results</h4>
          </div>
          <div class="modal-body"></div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div>


<footer>


	<span class="copyright">
	Eric Satterwhite &copy; 2015
	</span>

<span class="jsdoc-message">
	Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a>
	
		on 2016-09-13T13:55:15-05:00
	
	using the <a href="https://github.com/docstrap/docstrap">DocStrap template</a>.
</span>
</footer>

<script src="scripts/docstrap.lib.js"></script>
<script src="scripts/toc.js"></script>

    <script type="text/javascript" src="scripts/fulltext-search-ui.js"></script>


<script>
$( function () {
	$( "[id*='$']" ).each( function () {
		var $this = $( this );

		$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
	} );

	$( ".tutorial-section pre, .readme-section pre, pre.prettyprint.source" ).each( function () {
		var $this = $( this );

		var example = $this.find( "code" );
		exampleText = example.html();
		var lang = /{@lang (.*?)}/.exec( exampleText );
		if ( lang && lang[1] ) {
			exampleText = exampleText.replace( lang[0], "" );
			example.html( exampleText );
			lang = lang[1];
		} else {
			var langClassMatch = example.parent()[0].className.match(/lang\-(\S+)/);
			lang = langClassMatch ? langClassMatch[1] : "javascript";
		}

		if ( lang ) {

			$this
			.addClass( "sunlight-highlight-" + lang )
			.addClass( "linenums" )
			.html( example.html() );

		}
	} );

	Sunlight.highlightAll( {
		lineNumbers : false,
		showMenu : true,
		enableDoclinks : true
	} );

	$.catchAnchorLinks( {
        navbarOffset: 10
	} );
	$( "#toc" ).toc( {
		anchorName  : function ( i, heading, prefix ) {
			return $( heading ).attr( "id" ) || ( prefix + i );
		},
		selectors   : "#toc-content h1,#toc-content h2,#toc-content h3,#toc-content h4",
		showAndHide : false,
		smoothScrolling: true
	} );

	$( "#main span[id^='toc']" ).addClass( "toc-shim" );
	$( '.dropdown-toggle' ).dropdown();

    $( "table" ).each( function () {
      var $this = $( this );
      $this.addClass('table');
    } );

} );
</script>



<!--Navigation and Symbol Display-->


<!--Google Analytics-->



    <script type="text/javascript">
        $(document).ready(function() {
            SearcherDisplay.init();
        });
    </script>


</body>
</html>